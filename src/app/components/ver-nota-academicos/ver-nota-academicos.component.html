<div class="breadcrumbs">
    <div class="breadcrumbs-inner">
      <div class="row m-0">
        <div class="col-sm-4">
          <div class="page-header float-left">
            <div class="page-title user-name-txt">
              <h1>Notas Academicos</h1>
            </div>
          </div>
        </div>
        <div class="col-sm-8">
          <div class="page-header float-right">
            <div class="page-title">
              <ol class="breadcrumb d-flex justify-content-end user-surname-txt">
                <li><a href="#">Inicio</a></li>
                <li class="active">Notas Academicos</li>
              </ol>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="breadcrumbs">
    <div class="breadcrumbs-inner">
      <div class="row m-0 align-items-center">
        <div class="col-sm-4">
          <div class="page-header float-left">
            <div class="page-title user-name-txt d-flex align-items-center justify-content-start">
              <i class="fa fa-calendar mr-3"></i>
              <h1 class="user-name-txt mb-0">Periodos:</h1>
            </div>
          </div>
        </div>
        
<!-- Selector de periodo alineado a la derecha -->
<div class="col-sm-8 text-right">
        <form [formGroup]="notasAcademicasForm" class="d-inline-block">
            <div class="form-group mb-0">
              <dx-select-box
                placeholder="Seleccione una opción."
                class="text-color-placeholder"
                [dataSource]="periodoAcademico"
                displayExpr="peNombre"
                valueExpr="idperiodo"
                [inputAttr]="{ 'aria-label': 'Periodo' }"
                [showClearButton]="true"
                formControlName="selectPeriodo"
                (onValueChanged)="cargarNotasPorAlumno()">
              </dx-select-box>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>

  <section id="ver-nota-academicos">
    <div class="content">
      <div class="animated fadeIn">
        <div class="row">
          <div class="col-lg-12">
            <div class="card">
              <div class="card-body">
                <div class="table-stats order-table ov-h">
                    <table class="table table-striped table-bordered" id="tablaNotasAcademicas">
                        <thead class="bg-primary text-white">
                          <tr>
                            <th>Área</th>
                            <th>Asignatura</th>
                            <th *ngFor="let bimestre of notasPorArea?.[0]?.asignaturas?.[0]?.promediosPorBimestre || []">
                              {{ bimestre.bimestre }}
                            </th>
                            <th>Promedio</th>
                            <th>Calificación</th>
                          </tr>
                        </thead>
                        <tbody>
                          <!-- Se repetira sobre las areas  -->
                          <ng-container *ngFor="let area of notasPorArea">
                            <tr>
                              <!-- Columna del área con rowspan -->
                              <td [attr.rowspan]="area.asignaturas.length" class="align-middle">
                                {{ area.area }}
                              </td>
                              <!-- Primera fila de asignaturas -->
                              <td class="align-middle">{{ area.asignaturas[0].asignatura }}</td>
                              <td *ngFor="let bimestre of area.asignaturas[0]?.promediosPorBimestre" class="align-middle">
                                <span [ngClass]="obtenerColorNota(bimestre.promedio)">
                                  {{ bimestre.promedio !== null ? bimestre.promedio.toFixed(2) : 'N/A' }}
                                </span>
                              </td>
                              <!-- Columna del promedio por área -->
                              <td class="align-middle" [attr.rowspan]="area.asignaturas.length">
                                <span>
                                  {{ calcularPromedioPorArea(area) !== null
                                    ? calcularPromedioPorArea(area)?.toFixed(2)
                                    : 'N/A' }}
                                </span>
                              </td>
                              <!-- Columna de Calificación (rowspan para la primera fila de cada área) -->
                              <td class="align-middle" [attr.rowspan]="area.asignaturas.length">
                                <span>
                                  {{ asignarCalificacion(calcularPromedioPorArea(area)) }}
                                </span>
                              </td>
                            </tr>
                            <!-- Filas adicionales de asignaturas dentro del área -->
                            <tr *ngFor="let asignatura of area.asignaturas.slice(1)">
                              <td class="align-middle">{{ asignatura.asignatura }}</td>
                              <td *ngFor="let bimestre of asignatura.promediosPorBimestre" class="align-middle">
                                <span [ngClass]="obtenerColorNota(bimestre.promedio)">
                                  {{ bimestre.promedio !== null ? bimestre.promedio.toFixed(2) : 'N/A' }}
                                </span>
                              </td>
                              <td hidden class="align-middle"></td> <!-- Se agrega una celda vacía solo para asegurar la alineación -->
                            </tr>
                          </ng-container>
                        </tbody>
                      </table>
                      
                </div>
                <div *ngIf="errorMessage" class="alert alert-warning text-center">
                  {{ errorMessage }}
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
  
  


  